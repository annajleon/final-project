---
title: "STAT 184 Final Project"
subtitle: "NYC AirBnb Data"
author: "Anna Leon"
output: html_notebook
---

## Front Matter

```{r}
# clean up workspace environment
rm(list = ls())

# all packages used for the assignment
library(DataComputing)
library(readr)
library(dplyr)
```

## Goal of my NYC Airbnb Data Exploration

The goal of my exploration of the NYC Airbnb data is to figure out what the relative pricing is between boroughs, neighborhoods, and hosts. My primary research question is what hosts and locations should I look into if I want an expensive Airbnb? a cheap Airbnb?


## Data Access

### Reading in Data
```{r}
NYC <- read_csv("AB_NYC_2019.csv")
```

### Exploring our Data

```{r}
glimpse(NYC) 
```

```{r}
head(NYC)
```


## Data Wrangling

I am dropping variables id, host_name, last_review, minimum_nights, and reviews_per_month because they are not relevant to my analysis. I am also dropping latitude and longitude because I am using neighbourhoods and neighbourhood_group to classify location rather than latitude and longitude. I am also changing the name of the neighbourhood_group column to borough because that is the more common term used to describe the areas of NYC: Manhattan, Bronx, etc. I also am renaming the neighbourhood column to neighborhood to represent American spelling. I also shortened some of the variable/column names. 

```{r}
NYC <-
  NYC %>%
    select(name, host_id, neighbourhood, neighbourhood_group, room_type, price, calculated_host_listings_count, availability_365) %>%
    rename(borough = neighbourhood_group, neighborhood = neighbourhood, host_listings_count = calculated_host_listings_count)
NYC
```

### NYC Airbnb Hosts

```{r}
HostListingsCount <-
  NYC %>%
    group_by(host_id) %>%
    summarise(listings = n()) %>%
    arrange(desc(listings))
HostListingsCount
```

Now, host 219517861 has the most listings in NYC, 327. So, where are his listings?
We can find out that they are all in Manhattan.

```{r}
NYC %>%
  filter(host_id == 219517861) %>%
  group_by(borough) %>%
  summarise(count = n())
```

### Listing Boroughs for Top Hosts

As we can see here, nine out of the top ten hosts with the most Airbnb listings in NYC had the highest number of listings in Manhattan out of the five boroughs.
```{r}
TopHosts <-
  HostListingsCount %>%
    head(10)
TopHosts$top_borough = NA

for(i in 1:10){
  Ranked <-
      NYC %>%
        filter(host_id == TopHosts$host_id[i]) %>%
        group_by(borough) %>%
        summarise(count = n()) %>%
        mutate(rank = rank(count)) %>%
        arrange(desc(rank)) 
    TopHosts$top_borough[i] <- toString(Ranked[1,1])
}
TopHosts
```

### Price Comparison between Boroughs

```{r}
BoroughAvgPrice <-
  NYC %>%
    group_by(borough) %>%
    summarise(avg_price = round(mean(price, na.rm=TRUE))) %>%
    arrange(desc(avg_price))
BoroughAvgPrice

NYCwAvg <-
  NYC %>%
    left_join(BoroughAvgPrice, by = c("borough" = "borough")) %>%
    rename(avg_price_in_borough = avg_price)
NYCwAvg
```

### Price Comparison between Neighborhoods

```{r}
NeighborhoodAvgPrice <-
  NYC %>%
    group_by(neighborhood) %>%
    summarise(avg_price = round(mean(price, na.rm=TRUE))) %>%
    arrange(desc(avg_price))

HoodinBorough <-
  NYC %>%
    group_by(borough, neighborhood) %>%
    summarise(count = n())

HoodInfo <-
  NeighborhoodAvgPrice %>%
    left_join(HoodinBorough) %>%
    left_join(BoroughAvgPrice, by = c("borough" = "borough")) %>%
    rename(avg_price_hood = avg_price.x, avg_price_borough = avg_price.y)
HoodInfo
```

### Classifying Neighborhoods as Expensive, Moderate, or Cheap for their Borough

Here, I want to classify each neighborhood as expensive, moderate, or cheap, as it compares to the average price of Airbnbs in its borough. That way users who want to stay in Queens, for example, can determine which neighborhoods within Queens are moderately priced, aka close to the average price of the borough.

```{r}
HoodPriceRange <-
  HoodInfo %>%
    select(neighborhood, avg_price_hood, avg_price_borough, borough)
HoodPriceRange$price_range = NA

for(i in 1:221){
  if((HoodInfo[i,2] - HoodInfo[i, 5]) > 30){
    range <- "expensive"
  } else if((HoodInfo[i,2] - HoodInfo[i, 5]) < -30){
    range <- "cheap"
  } else{
    range <- "moderate"
  }
     
  HoodPriceRange$price_range[i] <- range
}

HoodPriceRange <-
  HoodPriceRange %>%
    select(neighborhood, borough, price_range)
HoodPriceRange
```

### "Cozy" Airbnbs

Now, I will be investigating the difference between price and availability of airbnbs that do not have the word cozy in their title with those that do. It turns out that airbnbs that are described as cozy typically cost less than their counterparts; however, their availability is lower as well. 

```{r}
CozyAirbnbs <-
  NYC %>%
    filter(grepl("cozy", name, ignore.case = TRUE))

NotCozyAirbnbs <-
  NYC %>%
    filter(!grepl("cozy", name, ignore.case = TRUE))

CozyAirbnbs
NotCozyAirbnbs

CozyAirbnbs %>%
  summarise(ave_cost = round(mean(price, na.rm = TRUE), 2))

NotCozyAirbnbs %>%
  summarise(ave_cost = round(mean(price, na.rm = TRUE), 2))

CozyAirbnbs %>%
  summarise(ave_availability = round(mean(availability_365, na.rm = TRUE)))

NotCozyAirbnbs %>%
  summarise(ave_availability = round(mean(availability_365, na.rm = TRUE)))
```


## Data Visualization

### Most Expensive Neighborhoods

```{r}
HoodInfo$neighborhood <- factor(HoodInfo$neighborhood,levels = c("Fort Wadsworth", "Woodrow", "Tribeca", "Sea Gate", "Riverdale"))

HoodInfo %>%
  head(5) %>%
  ggplot(aes(x=neighborhood, y=avg_price)) + 
  geom_point(aes(size=count)) +
  ggtitle("5 Most Expensive Neighborhoods for Airbnbs")
```

### Favorite borough of top ten hosts visualization 

```{r}
slices <- c(9,1)
pie(slices, labels = c("Manhattan, Queens"), main="Favorite Boroughs of Top Hosts")
```

