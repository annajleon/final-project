---
title: "STAT 184 Final Project"
subtitle: "NYC AirBnb Data"
author: "Anna Leon"
output: html_notebook
---

## Front Matter

```{r}
# clean up workspace environment
rm(list = ls())

# all packages used for the assignment
library(DataComputing)
library(readr)
library(dplyr)
```

## Goal of my NYC Airbnb Data Exploration

The goal of my exploration of the NYC Airbnb data is to figure out what the relative pricing is between boroughs, neighborhoods, and hosts. My primary research question is what hosts and locations should I look into if I want an expensive Airbnb? a cheap Airbnb?


## Data Access

### Reading in Data
```{r}
NYC <- read_csv("AB_NYC_2019.csv")
```

### Exploring our Data

```{r}
glimpse(NYC) 
```

```{r}
head(NYC)
```


## Data Wrangling

I am dropping variables id, host_name, last_review, minimum_nights, and reviews_per_month because they are not relevant to my analysis. I am also dropping latitude and longitude because I am using neighbourhoods and neighbourhood_group to classify location rather than latitude and longitude. I am also changing the name of the neighbourhood_group column to borough because that is the more common term used to describe the areas of NYC: Manhattan, Bronx, etc. I also am renaming the neighbourhood column to neighborhood to represent American spelling. I also shortened some of the variable/column names. 

```{r}
NYC <-
  NYC %>%
    select(name, host_id, neighbourhood, neighbourhood_group, room_type, price, calculated_host_listings_count, availability_365) %>%
    rename(borough = neighbourhood_group, neighborhood = neighbourhood, host_listings_count = calculated_host_listings_count)
NYC
```

### NYC Airbnb Hosts and Top Hosts Favorite Boroughs

Here, I have found who the top hosts are, defined as any host that has 30 or more listings in NYC. There are 27 of them.

```{r}
TopHosts <-
  NYC %>%
    group_by(host_id) %>%
    summarise(listings = n()) %>%
    arrange(desc(listings)) %>%
    filter(listings >= 30)
TopHosts
```

As we can see here, the majority of the top hosts had the highest number of listings in Manhattan out of the five boroughs.

```{r}
TopHosts$top_borough = NA

for(i in 1:27){
  Ranked <-
      NYC %>%
        filter(host_id == TopHosts$host_id[i]) %>%
        group_by(borough) %>%
        summarise(count = n()) %>%
        mutate(rank = rank(count)) %>%
        arrange(desc(rank)) 
    TopHosts$top_borough[i] <- toString(Ranked[1,1])
}

TopHosts
```

### Price Comparison between Boroughs

```{r}
BoroughPrice <-
  NYC %>%
    group_by(borough) %>%
    summarise(avg_price = round(mean(price, na.rm=TRUE))) %>%
    arrange(desc(avg_price))
BoroughPrice
```

```{r}
ListingPriceRange <-
  NYC %>%
    left_join(BoroughPrice) %>%
    select(name, borough, price, avg_price) %>%
    rename(borough_price = avg_price)
ListingPriceRange
```

```{r}
ListingPriceRange$price_range = NA

for(i in 1:48895){
  if((ListingPriceRange[i,3] - ListingPriceRange[i, 4]) > 30){
    range <- "expensive"
  } else if((ListingPriceRange[i,3] - ListingPriceRange[i, 4]) < -30){
    range <- "cheap"
  } else{
    range <- "moderate"
  }
     
  ListingPriceRange$price_range[i] <- range
}

ListingPriceRange <-
  ListingPriceRange %>%
    select(name, borough, price_range)
ListingPriceRange
```

### Price Comparison between Neighborhoods

```{r}
NeighborhoodAvgPrice <-
  NYC %>%
    group_by(neighborhood) %>%
    summarise(avg_price = round(mean(price, na.rm=TRUE))) %>%
    arrange(desc(avg_price))
NeighborhoodAvgPrice

HoodinBorough <-
  NYC %>%
    group_by(borough, neighborhood) %>%
    summarise(count = n())

HoodInfo <-
  NeighborhoodAvgPrice %>%
    left_join(HoodinBorough) %>%
    left_join(BoroughPrice, by = c("borough" = "borough")) %>%
    rename(avg_price_hood = avg_price.x, avg_price_borough = avg_price.y)
HoodInfo
```

Here, I want to classify each neighborhood as expensive, moderate, or cheap, as it compares to the average price of Airbnbs in its borough. That way users who want to stay in Queens, for example, can determine which neighborhoods within Queens are moderately priced, aka close to the average price of the borough.

```{r}
HoodPriceRange <-
  HoodInfo %>%
    select(neighborhood, avg_price_hood, avg_price_borough, borough)
HoodPriceRange$price_range = NA

for(i in 1:221){
  if((HoodInfo[i,2] - HoodInfo[i, 5]) > 30){
    range <- "expensive"
  } else if((HoodInfo[i,2] - HoodInfo[i, 5]) < -30){
    range <- "cheap"
  } else{
    range <- "moderate"
  }
     
  HoodPriceRange$price_range[i] <- range
}

HoodPriceRange <-
  HoodPriceRange %>%
    select(neighborhood, borough, price_range)
HoodPriceRange
```

### "Cozy" Airbnbs

Now, I will be investigating the difference between price and availability of airbnbs that do not have the word cozy in their title with those that do. It turns out that airbnbs that are described as cozy typically cost less than their counterparts; however, their availability is lower as well. 

```{r}
CozyAirbnbs <-
  NYC %>%
    filter(grepl("cozy", name, ignore.case = TRUE))

NotCozyAirbnbs <-
  NYC %>%
    filter(!grepl("cozy", name, ignore.case = TRUE))

CozyAirbnbs
NotCozyAirbnbs

CozyAirbnbs %>%
  summarise(ave_cost = round(mean(price, na.rm = TRUE), 2))

NotCozyAirbnbs %>%
  summarise(ave_cost = round(mean(price, na.rm = TRUE), 2))

CozyAirbnbs %>%
  summarise(ave_availability = round(mean(availability_365, na.rm = TRUE)))

NotCozyAirbnbs %>%
  summarise(ave_availability = round(mean(availability_365, na.rm = TRUE)))
```


## Data Visualization

### Most Expensive Neighborhoods

```{r}
HoodShort <-
  HoodInfo %>%
    head(5)

HoodShort$neighborhood <- factor(HoodShort$neighborhood,levels = c("Fort Wadsworth", "Woodrow", "Tribeca", "Sea Gate", "Riverdale"))

HoodShort %>%
  ggplot(aes(x=neighborhood, y=avg_price_hood)) + 
  geom_point(aes(size=count)) +
  ggtitle("5 Most Expensive Neighborhoods for Airbnbs")
```

### Price Distribution

```{r}
HoodInfo %>%
  ggplot(aes(x = neighborhood, y = avg_price_hood)) +
  geom_point() +
  facet_grid(~ borough) + 
  ylab("average price of neighborhood") +
  theme(axis.text.x = element_blank())
```

### Listing Price Range per Borough

```{r}
ListingPriceRange$price_range <- factor(ListingPriceRange$price_range,levels = c("cheap", "moderate", "expensive"))

ListingPriceRange %>%
  ggplot(aes(x = price_range)) +
  geom_bar() + 
  facet_wrap(~ borough)
```

### Neighborhood Price Range per Borough

```{r}
HoodPriceRange$price_range <- factor(HoodPriceRange$price_range,levels = c("cheap", "moderate", "expensive"))

HoodPriceRange %>%
  ggplot(aes(x = price_range)) +
  geom_bar() + 
  facet_wrap(~ borough)
```
  

